language: python
python:
    - '3.5'

sudo: false
cache: pip

services:
    - mysql
    - postgresql

install:
    - pip install pip --upgrade
    - pip install -e .
    - pip install -r doc_requirements.txt
    - pip install flake8

before_script:
    - flake8 secuml
    - flake8 scripts
    - mkdir output_data
    - ./travis_tools/setup_db.sh

script:
    - ./travis_tools/test_scripts.sh
    - sphinx-build -nWT docs/ docs/_build/html

deploy:
    provider: pages
    target-branch: gh-pages
    local-dir: docs/_build/html
    skip-cleanup: true
    github-token: $GITHUB_TOKEN
    keep-history: true
    on:
        branch: master
